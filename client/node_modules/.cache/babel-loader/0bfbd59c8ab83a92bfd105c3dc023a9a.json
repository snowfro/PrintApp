{"ast":null,"code":"import _classCallCheck from\"/Users/Erick/Desktop/punkprintapp/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Erick/Desktop/punkprintapp/client/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Erick/Desktop/punkprintapp/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Erick/Desktop/punkprintapp/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Erick/Desktop/punkprintapp/client/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Erick/Desktop/punkprintapp/client/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import Canvas from'./canvas';import Web3 from'web3';var web3=new Web3(Web3.givenProvider||\"http://localhost:8545\");var Purchase=/*#__PURE__*/function(_React$Component){_inherits(Purchase,_React$Component);function Purchase(props){var _this;_classCallCheck(this,Purchase);_this=_possibleConstructorReturn(this,_getPrototypeOf(Purchase).call(this,props));_this.state={purchaseType:null,shipType:null,stackId:null};_this.handleTypeRadio=_this.handleTypeRadio.bind(_assertThisInitialized(_this));_this.handleShipRadio=_this.handleShipRadio.bind(_assertThisInitialized(_this));_this.handleGoBack=_this.handleGoBack.bind(_assertThisInitialized(_this));_this.handlePurchase=_this.handlePurchase.bind(_assertThisInitialized(_this));_this.handleStartOver=_this.handleStartOver.bind(_assertThisInitialized(_this));return _this;}_createClass(Purchase,[{key:\"handleGoBack\",value:function handleGoBack(){this.props.handleWelcomeChange(-1);}},{key:\"handleStartOver\",value:function handleStartOver(){this.props.handleWelcomeChange(-2);}},{key:\"handleTypeRadio\",value:function handleTypeRadio(event){this.setState({purchaseType:event.target.value});}},{key:\"handleShipRadio\",value:function handleShipRadio(event){this.setState({shipType:event.target.value});}},{key:\"findPrice\",value:function findPrice(){if(this.state.purchaseType===\"Print + NFC\"){if(this.state.shipType===\"Domestic\"){return'pricePerPrintInWei';}else{return'pricePerPrintIntlShipInWei';}}else if(this.state.purchaseType===\"NFC Only\"){if(this.state.shipType===\"Domestic\"){return'pricePerNFCInWei';}else{return'pricePerNFCIntlShipInWei';}}}},{key:\"handlePurchase\",value:function handlePurchase(purchaseType){var stackId;var _this$props=this.props,drizzle=_this$props.drizzle,drizzleState=_this$props.drizzleState;var contract1=drizzle.contracts.PunkPrintRegistry;var contract2=drizzle.contracts.PunkPrintRegistryMinter;var purchaseFunc='';if(purchaseType==='pricePerPrintInWei'||purchaseType==='pricePerPrintIntlShipInWei'){purchaseFunc='purchasePrint';}else if(purchaseType==='pricePerNFCInWei'||purchaseType==='pricePerNFCIntlShipInWei'){purchaseFunc='purchaseNFCOnly';}else{purchaseFunc='purchaseMisc';}console.log(\"type: \"+purchaseType+\" Func: \"+purchaseFunc);var determineAmount=drizzleState.contracts.PunkPrintRegistry[purchaseType];var amountToSend=determineAmount['0x0'].value;console.log(\"sending \"+amountToSend+\"contact \"+this.props.contactMethod+\"Punk \"+this.props.punkId+\"using: \"+purchaseFunc);var creditPurchaseConcat=purchaseFunc+\" | \"+this.props.contactMethod;var creditsToUse=this.props.drizzleState.contracts.PunkPrintRegistryMinter.addressToCreditsToSpend[this.props.creditsToUseKey];if(creditsToUse&&creditsToUse.value>0){stackId=contract2.methods['mint'].cacheSend(this.props.punkId,creditPurchaseConcat,{from:drizzleState.accounts[0],value:0});}else{stackId=contract1.methods[purchaseFunc].cacheSend(this.props.punkId,this.props.contactMethod,{from:drizzleState.accounts[0],value:amountToSend});}// save the `stackId` for later reference\nthis.setState({stackId:stackId});}},{key:\"getStatus\",value:function getStatus(){var _this$props$drizzleSt=this.props.drizzleState,transactions=_this$props$drizzleSt.transactions,transactionStack=_this$props$drizzleSt.transactionStack;// get the transaction hash using our saved `stackId`\nvar txHash=transactionStack[this.state.stackId];// if transaction hash does not exist, don't display anything\nif(!txHash)return null;if(transactions[txHash]){console.log(transactions[txHash].status);return transactions[txHash].status;}}},{key:\"getTokenId\",value:function getTokenId(){var _this$props$drizzleSt2=this.props.drizzleState,transactions=_this$props$drizzleSt2.transactions,transactionStack=_this$props$drizzleSt2.transactionStack;var txHash=transactionStack[this.state.stackId];if(!txHash)return null;if(transactions[txHash]){if(transactions[txHash].status==='success'){var newTokenId=transactions[txHash].receipt.events.Transfer.returnValues[2];return newTokenId;}else{return null;}}}},{key:\"render\",value:function render(){var _this2=this;var contracts=this.props.drizzle.contracts;var PunkPrintRegistry=this.props.drizzleState.contracts.PunkPrintRegistry;var purchaseType=this.findPrice();console.log(contracts);console.log(this.props.drizzleState);//console.log(PunkPrintRegistry);\n//console.log(this.findPrice());\nvar pricePerPrintInWei=PunkPrintRegistry.pricePerPrintInWei['0x0'];var pricePerPrintIntlShipInWei=PunkPrintRegistry.pricePerPrintIntlShipInWei['0x0'];var pricePerNFCInWei=PunkPrintRegistry.pricePerNFCInWei['0x0'];var pricePerNFCIntlShipInWei=PunkPrintRegistry.pricePerNFCIntlShipInWei['0x0'];var pricePerMiscInWei=PunkPrintRegistry.pricePerMiscInWei['0x0'];var pricePerMiscIntlShipInWei=PunkPrintRegistry.pricePerMiscIntlShipInWei['0x0'];var priceObject={pricePerPrintInWei:pricePerPrintInWei,pricePerPrintIntlShipInWei:pricePerPrintIntlShipInWei,pricePerNFCInWei:pricePerNFCInWei,pricePerNFCIntlShipInWei:pricePerNFCIntlShipInWei,pricePerMiscInWei:pricePerMiscInWei,pricePerMiscIntlShipInWei:pricePerMiscIntlShipInWei};//if (this.findPrice()){ console.log(\"being bought: \"+ this.findPrice());}\nvar status=this.getStatus();var tokenId=this.getTokenId();var url=\"http://ppr.artblocks.io/details/\";if(tokenId){url=url+tokenId;}var creditsToUse=this.props.drizzleState.contracts.PunkPrintRegistryMinter.addressToCreditsToSpend[this.props.creditsToUseKey];if(creditsToUse){console.log('ctu: '+creditsToUse.value);}return React.createElement(\"div\",null,React.createElement(\"h1\",null,\"Punk Print Registry Purchase Page\"),React.createElement(\"br\",null),React.createElement(\"h4\",null,\"Almost there! Now you will choose your purchase options and complete the transaction for punk #\",this.props.punkId,\".\"),React.createElement(Canvas,{punkId:this.props.punkId}),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(\"p\",null,\"There are two ways to proceed. You may purchase a 12\\\"x12\\\" (30.5x30.5cm) high quality digital print with attached authentication NFC or if you already have a nice print you can simply buy the NFC sticker for authentications. Please select one:\"),React.createElement(\"label\",null,React.createElement(\"input\",{type:\"radio\",name:\"purchaseType\",value:\"Print + NFC\",onChange:this.handleTypeRadio}),\"Purchase Print+NFC\"),React.createElement(\"br\",null),React.createElement(\"label\",null,React.createElement(\"input\",{type:\"radio\",name:\"purchaseType\",value:\"NFC Only\",onChange:this.handleTypeRadio}),\"Purchase NFC Only\"),this.state.purchaseType&&React.createElement(\"div\",null,React.createElement(\"h4\",null,\"Purchase Type: \",this.state.purchaseType),React.createElement(\"br\",null),React.createElement(\"p\",null,\"Now we need to know where this is going. Please select whether you are located in the USA or abroad. Item price will adjust accordingly.\"),React.createElement(\"label\",null,React.createElement(\"input\",{type:\"radio\",name:\"shipType\",value:\"Domestic\",onChange:this.handleShipRadio}),\"Domestic Shipping (within USA)\"),React.createElement(\"br\",null),React.createElement(\"label\",null,React.createElement(\"input\",{type:\"radio\",name:\"shipType\",value:\"International\",onChange:this.handleShipRadio}),\"International Shipping\"),this.state.shipType&&React.createElement(\"div\",null,React.createElement(\"h4\",null,\"Shiping Type: \",this.state.shipType),React.createElement(\"br\",null),React.createElement(\"h4\",null,\"Total: \",creditsToUse&&creditsToUse.value>0?'FRE':priceObject[this.findPrice()]&&web3.utils.fromWei(priceObject[this.findPrice()].value.toString(),'ether'),\"\\u039E\"),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(\"button\",{className:\"bigButton\",disabled:status?true:false,onClick:function onClick(){_this2.handlePurchase(purchaseType);}},status?status:'Purchase'),status==='success'&&React.createElement(\"div\",null,React.createElement(\"h1\",null,\"Congrats!\"),React.createElement(\"h4\",null,\"Your transaction is complete! Please reach out to info@artblocks.io or Snowfro#8886 on Discord using the recorded contact method so we can get your package to you ASAP.\"),React.createElement(\"br\",null),React.createElement(\"h4\",null,\"Your Print Registry TokenId for this transaction is \",tokenId,\". You can visit your authentication page at \",React.createElement(\"a\",{href:url},url),\". Note that the NFC UID will be set manually at time of printing.\"),React.createElement(\"p\",null,\" You will be provided with a tracking number once your package has shipped. Please allow 1-2 weeks for delivery.\")))),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(\"button\",{onClick:status==='success'?this.handleStartOver:this.handleGoBack},status==='success'?'Start Over':'Go Back'));}}]);return Purchase;}(React.Component);export default Purchase;","map":{"version":3,"sources":["/Users/Erick/Desktop/punkprintapp/client/src/purchase.js"],"names":["React","Canvas","Web3","web3","givenProvider","Purchase","props","state","purchaseType","shipType","stackId","handleTypeRadio","bind","handleShipRadio","handleGoBack","handlePurchase","handleStartOver","handleWelcomeChange","event","setState","target","value","drizzle","drizzleState","contract1","contracts","PunkPrintRegistry","contract2","PunkPrintRegistryMinter","purchaseFunc","console","log","determineAmount","amountToSend","contactMethod","punkId","creditPurchaseConcat","creditsToUse","addressToCreditsToSpend","creditsToUseKey","methods","cacheSend","from","accounts","transactions","transactionStack","txHash","status","newTokenId","receipt","events","Transfer","returnValues","findPrice","pricePerPrintInWei","pricePerPrintIntlShipInWei","pricePerNFCInWei","pricePerNFCIntlShipInWei","pricePerMiscInWei","pricePerMiscIntlShipInWei","priceObject","getStatus","tokenId","getTokenId","url","utils","fromWei","toString","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Canvas from './canvas';\nimport Web3 from 'web3';\nconst web3 = new Web3(Web3.givenProvider || \"http://localhost:8545\");\n\nclass Purchase extends React.Component{\n  constructor(props){\n  super(props);\n  this.state = {purchaseType:null, shipType:null, stackId:null}\n  this.handleTypeRadio = this.handleTypeRadio.bind(this);\n  this.handleShipRadio = this.handleShipRadio.bind(this);\n  this.handleGoBack = this.handleGoBack.bind(this);\n  this.handlePurchase = this.handlePurchase.bind(this);\n  this.handleStartOver = this.handleStartOver.bind(this);\n}\n\nhandleGoBack(){\n  this.props.handleWelcomeChange(-1);\n}\n\nhandleStartOver(){\n  this.props.handleWelcomeChange(-2);\n}\n  handleTypeRadio (event){\n    this.setState({purchaseType:event.target.value});\n  }\n\n  handleShipRadio (event){\n    this.setState({shipType:event.target.value});\n  }\n\n  findPrice(){\n    if (this.state.purchaseType === \"Print + NFC\"){\n      if (this.state.shipType === \"Domestic\") {\n        return 'pricePerPrintInWei';\n      } else {\n        return 'pricePerPrintIntlShipInWei'\n      }\n    } else if (this.state.purchaseType === \"NFC Only\") {\n      if (this.state.shipType === \"Domestic\") {\n      return 'pricePerNFCInWei';\n    } else {\n      return 'pricePerNFCIntlShipInWei';\n    }\n  }\n  }\n\n  handlePurchase(purchaseType){\n    let stackId;\n    const { drizzle, drizzleState } = this.props;\n    const contract1 = drizzle.contracts.PunkPrintRegistry;\n    const contract2 = drizzle.contracts.PunkPrintRegistryMinter;\n    let purchaseFunc='';\n\n    if (purchaseType === 'pricePerPrintInWei' || purchaseType === 'pricePerPrintIntlShipInWei'){\n      purchaseFunc = 'purchasePrint'\n    } else if (purchaseType === 'pricePerNFCInWei' || purchaseType === 'pricePerNFCIntlShipInWei'){\n      purchaseFunc = 'purchaseNFCOnly'\n    } else {\n      purchaseFunc = 'purchaseMisc'\n    }\n\n  console.log(\"type: \"+purchaseType + \" Func: \"+ purchaseFunc);\n\n    const determineAmount = drizzleState.contracts.PunkPrintRegistry[purchaseType];\n    const amountToSend = determineAmount['0x0'].value;\n    console.log(\"sending \"+ amountToSend + \"contact \"+this.props.contactMethod + \"Punk \" + this.props.punkId+ \"using: \"+ purchaseFunc);\n\n    const creditPurchaseConcat = purchaseFunc + \" | \" + this.props.contactMethod;\n    const creditsToUse = this.props.drizzleState.contracts.PunkPrintRegistryMinter.addressToCreditsToSpend[this.props.creditsToUseKey];\n\n    if (creditsToUse && creditsToUse.value>0){\n      stackId = contract2.methods['mint'].cacheSend(this.props.punkId,creditPurchaseConcat, {\n        from: drizzleState.accounts[0],\n        value: 0\n      });\n    } else {\n      stackId = contract1.methods[purchaseFunc].cacheSend(this.props.punkId,this.props.contactMethod, {\n        from: drizzleState.accounts[0],\n        value: amountToSend\n      });\n    }\n    // save the `stackId` for later reference\n    this.setState({ stackId });\n  };\n\ngetStatus(){\n  const { transactions, transactionStack } = this.props.drizzleState;\n  // get the transaction hash using our saved `stackId`\n  const txHash = transactionStack[this.state.stackId];\n  // if transaction hash does not exist, don't display anything\n  if (!txHash) return null;\n\n  if (transactions[txHash]){\n  console.log(transactions[txHash].status);\n  return transactions[txHash].status;\n}\n}\n\ngetTokenId(){\n  const {transactions, transactionStack } = this.props.drizzleState;\n  const txHash = transactionStack[this.state.stackId];\n  if (!txHash) return null;\n  if (transactions[txHash]){\n    if (transactions[txHash].status==='success'){\n    const newTokenId = transactions[txHash].receipt.events.Transfer.returnValues[2];\n    return newTokenId;\n  } else {\n    return null;\n  }\n}\n}\n\n\n\n\n  render(){\n    const {contracts} = this.props.drizzle;\n\n    const { PunkPrintRegistry } = this.props.drizzleState.contracts;\n    const purchaseType = this.findPrice();\n    console.log(contracts);\n    console.log(this.props.drizzleState);\n    //console.log(PunkPrintRegistry);\n    //console.log(this.findPrice());\n\n    const pricePerPrintInWei = PunkPrintRegistry.pricePerPrintInWei['0x0'];\n    const pricePerPrintIntlShipInWei = PunkPrintRegistry.pricePerPrintIntlShipInWei['0x0'];\n    const pricePerNFCInWei = PunkPrintRegistry.pricePerNFCInWei['0x0'];\n    const pricePerNFCIntlShipInWei = PunkPrintRegistry.pricePerNFCIntlShipInWei['0x0'];\n    const pricePerMiscInWei = PunkPrintRegistry.pricePerMiscInWei['0x0'];\n    const pricePerMiscIntlShipInWei = PunkPrintRegistry.pricePerMiscIntlShipInWei['0x0'];\n\n    let priceObject = {pricePerPrintInWei: pricePerPrintInWei, pricePerPrintIntlShipInWei:pricePerPrintIntlShipInWei,pricePerNFCInWei:pricePerNFCInWei,pricePerNFCIntlShipInWei:pricePerNFCIntlShipInWei,pricePerMiscInWei:pricePerMiscInWei, pricePerMiscIntlShipInWei:pricePerMiscIntlShipInWei};\n    //if (this.findPrice()){ console.log(\"being bought: \"+ this.findPrice());}\n    let status = this.getStatus();\n    let tokenId = this.getTokenId();\n    let url = \"http://ppr.artblocks.io/details/\";\n    if (tokenId) {\n      url = url+tokenId;\n    }\n\n\n    const creditsToUse = this.props.drizzleState.contracts.PunkPrintRegistryMinter.addressToCreditsToSpend[this.props.creditsToUseKey];\n\n    if(creditsToUse){\n      console.log('ctu: '+creditsToUse.value);\n    }\n    return (\n      <div>\n      <h1>Punk Print Registry Purchase Page</h1>\n      <br />\n      <h4>Almost there! Now you will choose your purchase options and complete the transaction for punk #{this.props.punkId}.</h4>\n    <Canvas\n    punkId={this.props.punkId}\n    />\n    <br />\n    <br />\n    <p>There are two ways to proceed. You may purchase a 12\"x12\" (30.5x30.5cm) high quality digital print with attached authentication NFC\n    or if you already have a nice print you can simply buy the NFC sticker for authentications. Please select one:</p>\n    <label><input type=\"radio\" name=\"purchaseType\" value=\"Print + NFC\" onChange={this.handleTypeRadio} />Purchase Print+NFC</label><br />\n    <label><input type=\"radio\" name=\"purchaseType\" value=\"NFC Only\" onChange={this.handleTypeRadio} />Purchase NFC Only</label>\n\n    {this.state.purchaseType &&\n      <div>\n      <h4>Purchase Type: {this.state.purchaseType}</h4>\n      <br />\n      <p>Now we need to know where this is going. Please select whether you are located in the USA or abroad. Item price will adjust accordingly.</p>\n      <label><input type=\"radio\" name=\"shipType\" value=\"Domestic\" onChange={this.handleShipRadio} />Domestic Shipping (within USA)</label><br />\n      <label><input type=\"radio\" name=\"shipType\" value=\"International\" onChange={this.handleShipRadio} />International Shipping</label>\n      {this.state.shipType &&\n      <div>\n      <h4>Shiping Type: {this.state.shipType}</h4>\n      <br />\n      <h4>Total: {creditsToUse && creditsToUse.value>0 ? 'FRE' : priceObject[this.findPrice()] && (web3.utils.fromWei(priceObject[this.findPrice()].value.toString(), 'ether'))}Îž</h4>\n      <br />\n      <br />\n      <button className = \"bigButton\" disabled = {status?true:false} onClick={() => {this.handlePurchase(purchaseType)}}>{status?status:'Purchase'}</button>\n      {status === 'success' &&\n    <div>\n    <h1>Congrats!</h1>\n    <h4>Your transaction is complete! Please reach out to info@artblocks.io or Snowfro#8886 on Discord using the recorded contact method\n    so we can get your package to you ASAP.</h4>\n    <br />\n    <h4>Your Print Registry TokenId for this transaction is {tokenId}. You can visit your authentication\n    page at <a href={url}>{url}</a>. Note that the NFC UID will be set manually at time of printing.</h4>\n    <p> You will be provided with a tracking number once your package has shipped. Please allow 1-2 weeks for delivery.</p>\n\n  </div>\n}\n      </div>\n    }\n      </div>\n    }\n    <br />\n    <br />\n    <button onClick = {status==='success'? this.handleStartOver : this.handleGoBack}>{status==='success'?'Start Over':'Go Back'}</button>\n    </div>\n  )\n  }\n\n}\n\nexport default Purchase;\n"]},"metadata":{},"sourceType":"module"}